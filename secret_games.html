<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>MiniCatsCraft 3D</title>
  <style>
    html, body { margin: 0; overflow: hidden; background: #222; font-family: sans-serif; }
    #ui {
      position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5);
      color: white; padding: 6px 10px; border-radius: 6px; font-size: 14px;
    }
    #hotbar {
      position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 8px; padding: 8px;
      background: rgba(30,30,30,0.7); border-radius: 10px;
    }
    .slot {
      width: 64px; height: 64px; border: 2px solid #ccc; cursor: pointer;
      background-size: cover; background-position: center;
      transition: border 0.2s;
    }
    .selected {
      border: 2px solid yellow;
      box-shadow: 0 0 6px yellow;
    }
  </style>
</head>
<body>
  <div id="ui">FPS: <span id="fps">--</span></div>
  <div id="hotbar">
    <div class="slot selected" data-type="grass" style="background-image:url('https://i.imgur.com/3Y6s4F7.png');"></div>
    <div class="slot" data-type="dirt" style="background-image:url('https://i.imgur.com/oVzQPIz.png');"></div>
    <div class="slot" data-type="stone" style="background-image:url('https://i.imgur.com/ZdAh9X3.png');"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xa0d8ef);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const loader = new THREE.TextureLoader();
    const mats = {
      grass: new THREE.MeshLambertMaterial({ map: loader.load("https://i.imgur.com/3Y6s4F7.png") }),
      dirt:  new THREE.MeshLambertMaterial({ map: loader.load("https://i.imgur.com/oVzQPIz.png") }),
      stone: new THREE.MeshLambertMaterial({ map: loader.load("https://i.imgur.com/ZdAh9X3.png") })
    };
    const types = Object.keys(mats);
    let selectedIndex = 0;
    let selectedType = types[selectedIndex];

    document.querySelectorAll(".slot").forEach((el, i) => {
      el.addEventListener("click", () => {
        selectedIndex = i;
        selectedType = el.dataset.type;
        document.querySelectorAll(".slot").forEach(s => s.classList.remove("selected"));
        el.classList.add("selected");
      });
    });

    window.addEventListener("wheel", e => {
      selectedIndex = (selectedIndex + (e.deltaY > 0 ? 1 : -1) + types.length) % types.length;
      selectedType = types[selectedIndex];
      document.querySelectorAll(".slot").forEach((s, i) =>
        s.classList.toggle("selected", i === selectedIndex)
      );
    });

    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const sun = new THREE.DirectionalLight(0xffffff, 0.8);
    sun.position.set(30, 50, 30);
    scene.add(sun);

    const controls = new THREE.PointerLockControls(camera, renderer.domElement);
    document.body.addEventListener("click", () => controls.lock());
    controls.getObject().position.set(0, 2, 5);
    scene.add(controls.getObject());

    const blocks = [];
    for (let x = -8; x <= 8; x++) {
      for (let z = -8; z <= 8; z++) {
        const cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), mats.grass);
        cube.position.set(x, 0, z);
        scene.add(cube);
        blocks.push(cube);
      }
    }

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    const raycaster = new THREE.Raycaster();

    function interact(place = true) {
      raycaster.setFromCamera({x:0,y:0}, camera);
      const hits = raycaster.intersectObjects(blocks);
      if (hits.length > 0) {
        const h = hits[0];
        if (place) {
          const pos = h.point.clone().add(h.face.normal).floor();
          const cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), mats[selectedType]);
          cube.position.copy(pos);
          scene.add(cube);
          blocks.push(cube);
        } else {
          scene.remove(h.object);
          blocks.splice(blocks.indexOf(h.object), 1);
        }
      }
    }

    document.addEventListener("mousedown", e => {
      if (!controls.isLocked) return;
      if (e.button === 0) interact(true);
      if (e.button === 2) interact(false);
    });
    document.addEventListener("contextmenu", e => e.preventDefault());

    let last = performance.now();
    function updateFPS() {
      const now = performance.now();
      const fps = Math.round(1000 / (now - last));
      last = now;
      document.getElementById("fps").textContent = fps;
    }

    const clock = new THREE.Clock();
    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();
      const speed = 4;

      const dir = new THREE.Vector3();
      controls.getDirection(dir);
      dir.y = 0; dir.normalize();
      const right = new THREE.Vector3().crossVectors(dir, camera.up).normalize();

      if (keys["z"]) controls.getObject().position.add(dir.clone().multiplyScalar(speed * delta));
      if (keys["s"]) controls.getObject().position.add(dir.clone().multiplyScalar(-speed * delta));
      if (keys["q"]) controls.getObject().position.add(right.clone().multiplyScalar(-speed * delta));
      if (keys["d"]) controls.getObject().position.add(right.clone().multiplyScalar(speed * delta));

      updateFPS();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
